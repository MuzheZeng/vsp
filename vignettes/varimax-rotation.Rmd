---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = FALSE
)
```

## References

https://en.wikipedia.org/wiki/Talk:Varimax_rotation 
http://gorayni.blogspot.com/2014/12/factor-analysis.html

```{python}
def varimax(Phi, gamma = 1.0, q = 20, tol = 1e-6):
  from numpy import eye, asarray, dot, sum, diag
  from numpy.linalg import svd
  p,k = Phi.shape
  R = eye(k)
  d=0
  for i in xrange(q):
    d_old = d
    Lambda = dot(Phi, R)
    u,s,vh = svd(dot(Phi.T,asarray(Lambda)**3 - (gamma/p) * dot(Lambda, diag(diag(dot(Lambda.T,Lambda))))))
    R = dot(u,vh)
    d = sum(s)
    if d_old!=0 and d/d_old < 1 + tol:
      break
  return dot(Phi, R)
```

